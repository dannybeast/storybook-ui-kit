{"version":3,"file":"index.m.js","sources":["../src/render.js","../src/decorators.js"],"sourcesContent":["const renderFnWarn = () => {\n  throw new Error('You must define a custom render function');\n};\n\nconst renderer = (baseOpts = {}, renderFn = renderFnWarn) => {\n  function html(Component, props = {}, contents) {\n    if (typeof Component === 'function') {\n      return Component(Object.assign({ props, contents }, baseOpts));\n    }\n    // render pug template\n    return renderFn(Component, { props });\n  }\n\n  function wrap(string) {\n    const el = document.createElement('div');\n    el.innerHTML = string;\n\n    if (el.firstElementChild) {\n      el.firstElementChild.$$raw = el.innerHTML;\n    }\n\n    return {\n      el,\n      $raw: el.innerHTML,\n      find: (selector) => el.querySelector(selector),\n      findAll: (selector) => el.querySelectorAll(selector),\n      html: () => el.innerHTML,\n      outer: () => el.outerHTML,\n      get $root() {\n        if (el.childElementCount === 1) {\n          return el.firstElementChild;\n        }\n        throw new Error(\n          'Unable to access root element of a multi-children component',\n        );\n      },\n    };\n  }\n\n  function render(Component, props, contents) {\n    return wrap(html(Component, props, contents));\n  }\n\n  const elMap = new Map();\n  function inject(el, ctx = document.body) {\n    elMap.set(el, ctx);\n    return ctx.appendChild(el);\n  }\n\n  function cleanup() {\n    for (const [el, ctx] of elMap) {\n      try {\n        ctx.removeChild(el);\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n  }\n\n  return {\n    html,\n    render,\n    wrap,\n    inject,\n    cleanup,\n  };\n};\n\nexport default renderer;\n","import { makeDecorator } from '@storybook/addons';\n\nconst WRAPPER_ID = 'storypug-wrapper';\n\nfunction getOrCreate(id, styles = []) {\n  const elementOnDom = document.getElementById(id);\n\n  if (elementOnDom) {\n    elementOnDom.parentElement.removeChild(elementOnDom);\n  }\n\n  const element = document.createElement('div');\n  element.id = id;\n  element.className = '';\n  element.removeAttribute('style');\n\n  styles.forEach((style) => {\n    if (typeof style === 'string') {\n      element.classList.add(style);\n    } else {\n      Object.assign(element.style, style);\n    }\n  });\n\n  return element;\n}\n\nfunction append(wrapper, component) {\n  if (typeof component === 'string') {\n    wrapper.innerHTML = component;\n    return wrapper.outerHTML;\n  }\n  wrapper.textContent = '';\n  wrapper.appendChild(component);\n  return wrapper;\n}\n\nexport const withStyle = makeDecorator({\n  name: 'withStyle',\n  parameterName: 'style',\n  skipIfNoParametersOrOptions: true,\n  wrapper(getStory, context, { parameters }) {\n    if (parameters === false) {\n      return getStory(context);\n    }\n    const wrapper = getOrCreate(\n      WRAPPER_ID,\n      [].concat(parameters).filter((x) => x),\n    );\n    return append(wrapper, getStory(context));\n  },\n});\n\nexport const fullscreen = makeDecorator({\n  name: 'fullscreen',\n  parameterName: 'fullscreen',\n  skipIfNoParametersOrOptions: false,\n  wrapper(getStory, context, { parameters }) {\n    if (parameters === false) {\n      return getStory(context);\n    }\n    const wrapper = getOrCreate(\n      `${WRAPPER_ID}--fullscreen`,\n      [fullscreen.baseClass].concat(parameters).filter((x) => x),\n    );\n    return append(wrapper, getStory(context));\n  },\n});\n\nfullscreen.baseClass = 'fullscreen';\n\nexport const withWrap = makeDecorator({\n  name: 'withWrap',\n  parameterName: 'wrap',\n  skipIfNoParametersOrOptions: true,\n  wrapper(getStory, context, { parameters = {} }) {\n    if (parameters === false) {\n      return getStory(context);\n    }\n    const { tag = 'div', style } = parameters;\n\n    const wrapper = document.createElement(tag);\n    [].concat(style).forEach((style) => {\n      if (!style) {\n        return;\n      }\n      if (typeof style === 'string') {\n        wrapper.classList.add(style);\n      } else {\n        Object.assign(wrapper.style, style);\n      }\n    });\n    return append(wrapper, getStory(context));\n  },\n});\n"],"names":["const","renderFnWarn","Error","renderer","baseOpts","renderFn","html","Component","props","contents","Object","assign","wrap","string","el","document","createElement","innerHTML","firstElementChild","$$raw","$raw","find","selector","querySelector","findAll","querySelectorAll","outer","outerHTML","childElementCount","elMap","Map","ctx","body","set","appendChild","removeChild","e","console","error","getOrCreate","id","styles","elementOnDom","getElementById","parentElement","element","className","removeAttribute","forEach","style","classList","add","append","wrapper","component","textContent","withStyle","makeDecorator","name","parameterName","skipIfNoParametersOrOptions","getStory","context","parameters","concat","filter","x","fullscreen","baseClass","withWrap","tag"],"mappings":"kDAAAA,IAAMC,mBACE,IAAIC,MAAM,6CAGZC,WAAYC,EAAeC,YACtBC,EAAKC,EAAWC,EAAYC,yBAAJ,IACN,mBAAdF,EACFA,EAAUG,OAAOC,OAAO,OAAEH,WAAOC,GAAYL,IAG/CC,EAASE,EAAW,OAAEC,aAGtBI,EAAKC,OACNC,EAAKC,SAASC,cAAc,cAClCF,EAAGG,UAAYJ,EAEXC,EAAGI,oBACLJ,EAAGI,kBAAkBC,MAAQL,EAAGG,WAG3B,IACLH,EACAM,KAAMN,EAAGG,UACTI,cAAOC,UAAaR,EAAGS,cAAcD,IACrCE,iBAAUF,UAAaR,EAAGW,iBAAiBH,IAC3ChB,uBAAYQ,EAAGG,WACfS,wBAAaZ,EAAGa,0BAEe,IAAzBb,EAAGc,yBACEd,EAAGI,wBAEN,IAAIhB,MACR,gFA7BmB,mBAAeD,OAuCpC4B,EAAQ,IAAIC,UAgBX,MACLxB,kBArBcC,EAAWC,EAAOC,UACzBG,EAAKN,EAAKC,EAAWC,EAAOC,UAsBnCG,kBAlBcE,EAAIiB,yBAAMhB,SAASiB,MACjCH,EAAMI,IAAInB,EAAIiB,GACPA,EAAIG,YAAYpB,qCAICe,kBAAO,CAA1B7B,6BAED+B,EAAII,YAAYrB,GAChB,MAAOsB,GACPC,QAAQC,MAAMF,QClDtB,SAASG,EAAYC,EAAIC,kBAAS,QAC1BC,EAAe3B,SAAS4B,eAAeH,GAEzCE,GACFA,EAAaE,cAAcT,YAAYO,OAGnCG,EAAU9B,SAASC,cAAc,cACvC6B,EAAQL,GAAKA,EACbK,EAAQC,UAAY,GACpBD,EAAQE,gBAAgB,SAExBN,EAAOO,iBAASC,GACO,iBAAVA,EACTJ,EAAQK,UAAUC,IAAIF,GAEtBvC,OAAOC,OAAOkC,EAAQI,MAAOA,KAI1BJ,EAGT,SAASO,EAAOC,EAASC,SACE,iBAAdA,GACTD,EAAQpC,UAAYqC,EACbD,EAAQ1B,YAEjB0B,EAAQE,YAAc,GACtBF,EAAQnB,YAAYoB,GACbD,OAGIG,EAAYC,EAAc,CACrCC,KAAM,YACNC,cAAe,QACfC,6BAA6B,EAC7BP,iBAAQQ,EAAUC,+BACG,IAAfC,EACKF,EAASC,GAMXV,EAJSb,EA3CD,mBA6Cb,GAAGyB,OAAOD,GAAYE,gBAAQC,UAAMA,KAEfL,EAASC,OAIvBK,EAAaV,EAAc,CACtCC,KAAM,aACNC,cAAe,aACfC,6BAA6B,EAC7BP,iBAAQQ,EAAUC,+BACG,IAAfC,EACKF,EAASC,GAMXV,EAJSb,iCAEd,CAAC4B,EAAWC,WAAWJ,OAAOD,GAAYE,gBAAQC,UAAMA,KAEnCL,EAASC,OAIpCK,EAAWC,UAAY,iBAEVC,EAAWZ,EAAc,CACpCC,KAAM,WACNC,cAAe,OACfC,6BAA6B,EAC7BP,iBAAQQ,EAAUC,0CAAwB,KACrB,IAAfC,SACKF,EAASC,8BAEJ,OAAOb,cAEfI,EAAUtC,SAASC,cAAcsD,YACpCN,OAAOf,GAAOD,iBAASC,GACnBA,IAGgB,iBAAVA,EACTI,EAAQH,UAAUC,IAAIF,GAEtBvC,OAAOC,OAAO0C,EAAQJ,MAAOA,MAG1BG,EAAOC,EAASQ,EAASC"}