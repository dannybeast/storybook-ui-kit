{"version":3,"file":"index.js","sources":["../src/render.js","../src/decorators.js"],"sourcesContent":["const renderFnWarn = () => {\n  throw new Error('You must define a custom render function');\n};\n\nconst renderer = (baseOpts = {}, renderFn = renderFnWarn) => {\n  function html(Component, props = {}, contents) {\n    if (typeof Component === 'function') {\n      return Component(Object.assign({ props, contents }, baseOpts));\n    }\n    // render pug template\n    return renderFn(Component, { props });\n  }\n\n  function wrap(string) {\n    const el = document.createElement('div');\n    el.innerHTML = string;\n\n    if (el.firstElementChild) {\n      el.firstElementChild.$$raw = el.innerHTML;\n    }\n\n    return {\n      el,\n      $raw: el.innerHTML,\n      find: (selector) => el.querySelector(selector),\n      findAll: (selector) => el.querySelectorAll(selector),\n      html: () => el.innerHTML,\n      outer: () => el.outerHTML,\n      get $root() {\n        if (el.childElementCount === 1) {\n          return el.firstElementChild;\n        }\n        throw new Error(\n          'Unable to access root element of a multi-children component',\n        );\n      },\n    };\n  }\n\n  function render(Component, props, contents) {\n    return wrap(html(Component, props, contents));\n  }\n\n  const elMap = new Map();\n  function inject(el, ctx = document.body) {\n    elMap.set(el, ctx);\n    return ctx.appendChild(el);\n  }\n\n  function cleanup() {\n    for (const [el, ctx] of elMap) {\n      try {\n        ctx.removeChild(el);\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n  }\n\n  return {\n    html,\n    render,\n    wrap,\n    inject,\n    cleanup,\n  };\n};\n\nexport default renderer;\n","import { makeDecorator } from '@storybook/addons';\n\nconst WRAPPER_ID = 'storypug-wrapper';\n\nfunction getOrCreate(id, styles = []) {\n  const elementOnDom = document.getElementById(id);\n\n  if (elementOnDom) {\n    elementOnDom.parentElement.removeChild(elementOnDom);\n  }\n\n  const element = document.createElement('div');\n  element.id = id;\n  element.className = '';\n  element.removeAttribute('style');\n\n  styles.forEach((style) => {\n    if (typeof style === 'string') {\n      element.classList.add(style);\n    } else {\n      Object.assign(element.style, style);\n    }\n  });\n\n  return element;\n}\n\nfunction append(wrapper, component) {\n  if (typeof component === 'string') {\n    wrapper.innerHTML = component;\n    return wrapper.outerHTML;\n  }\n  wrapper.textContent = '';\n  wrapper.appendChild(component);\n  return wrapper;\n}\n\nexport const withStyle = makeDecorator({\n  name: 'withStyle',\n  parameterName: 'style',\n  skipIfNoParametersOrOptions: true,\n  wrapper(getStory, context, { parameters }) {\n    if (parameters === false) {\n      return getStory(context);\n    }\n    const wrapper = getOrCreate(\n      WRAPPER_ID,\n      [].concat(parameters).filter((x) => x),\n    );\n    return append(wrapper, getStory(context));\n  },\n});\n\nexport const fullscreen = makeDecorator({\n  name: 'fullscreen',\n  parameterName: 'fullscreen',\n  skipIfNoParametersOrOptions: false,\n  wrapper(getStory, context, { parameters }) {\n    if (parameters === false) {\n      return getStory(context);\n    }\n    const wrapper = getOrCreate(\n      `${WRAPPER_ID}--fullscreen`,\n      [fullscreen.baseClass].concat(parameters).filter((x) => x),\n    );\n    return append(wrapper, getStory(context));\n  },\n});\n\nfullscreen.baseClass = 'fullscreen';\n\nexport const withWrap = makeDecorator({\n  name: 'withWrap',\n  parameterName: 'wrap',\n  skipIfNoParametersOrOptions: true,\n  wrapper(getStory, context, { parameters = {} }) {\n    if (parameters === false) {\n      return getStory(context);\n    }\n    const { tag = 'div', style } = parameters;\n\n    const wrapper = document.createElement(tag);\n    [].concat(style).forEach((style) => {\n      if (!style) {\n        return;\n      }\n      if (typeof style === 'string') {\n        wrapper.classList.add(style);\n      } else {\n        Object.assign(wrapper.style, style);\n      }\n    });\n    return append(wrapper, getStory(context));\n  },\n});\n"],"names":["renderFnWarn","Error","getOrCreate","id","styles","elementOnDom","document","getElementById","parentElement","removeChild","element","createElement","className","removeAttribute","forEach","style","classList","add","Object","assign","append","wrapper","component","innerHTML","outerHTML","textContent","appendChild","withStyle","makeDecorator","name","parameterName","skipIfNoParametersOrOptions","getStory","context","parameters","concat","filter","x","fullscreen","baseClass","withWrap","tag","baseOpts","renderFn","html","Component","props","contents","wrap","string","el","firstElementChild","$$raw","$raw","find","selector","querySelector","findAll","querySelectorAll","outer","childElementCount","elMap","Map","ctx","body","set","const","e","console","error"],"mappings":"mCAAMA,mBACE,IAAIC,MAAM,6CCGlB,SAASC,EAAYC,EAAIC,kBAAS,QAC1BC,EAAeC,SAASC,eAAeJ,GAEzCE,GACFA,EAAaG,cAAcC,YAAYJ,OAGnCK,EAAUJ,SAASK,cAAc,cACvCD,EAAQP,GAAKA,EACbO,EAAQE,UAAY,GACpBF,EAAQG,gBAAgB,SAExBT,EAAOU,iBAASC,GACO,iBAAVA,EACTL,EAAQM,UAAUC,IAAIF,GAEtBG,OAAOC,OAAOT,EAAQK,MAAOA,KAI1BL,EAGT,SAASU,EAAOC,EAASC,SACE,iBAAdA,GACTD,EAAQE,UAAYD,EACbD,EAAQG,YAEjBH,EAAQI,YAAc,GACtBJ,EAAQK,YAAYJ,GACbD,OAGIM,EAAYC,gBAAc,CACrCC,KAAM,YACNC,cAAe,QACfC,6BAA6B,EAC7BV,iBAAQW,EAAUC,+BACG,IAAfC,EACKF,EAASC,GAMXb,EAJSlB,EA3CD,mBA6Cb,GAAGiC,OAAOD,GAAYE,gBAAQC,UAAMA,KAEfL,EAASC,OAIvBK,EAAaV,gBAAc,CACtCC,KAAM,aACNC,cAAe,aACfC,6BAA6B,EAC7BV,iBAAQW,EAAUC,+BACG,IAAfC,EACKF,EAASC,GAMXb,EAJSlB,iCAEd,CAACoC,EAAWC,WAAWJ,OAAOD,GAAYE,gBAAQC,UAAMA,KAEnCL,EAASC,OAIpCK,EAAWC,UAAY,iBAEVC,EAAWZ,gBAAc,CACpCC,KAAM,WACNC,cAAe,OACfC,6BAA6B,EAC7BV,iBAAQW,EAAUC,0CAAwB,KACrB,IAAfC,SACKF,EAASC,8BAEJ,OAAOlB,cAEfM,EAAUf,SAASK,cAAc8B,YACpCN,OAAOpB,GAAOD,iBAASC,GACnBA,IAGgB,iBAAVA,EACTM,EAAQL,UAAUC,IAAIF,GAEtBG,OAAOC,OAAOE,EAAQN,MAAOA,MAG1BK,EAAOC,EAASW,EAASC,iCDxFlBS,EAAeC,YACtBC,EAAKC,EAAWC,EAAYC,yBAAJ,IACN,mBAAdF,EACFA,EAAU3B,OAAOC,OAAO,OAAE2B,WAAOC,GAAYL,IAG/CC,EAASE,EAAW,OAAEC,aAGtBE,EAAKC,OACNC,EAAK5C,SAASK,cAAc,cAClCuC,EAAG3B,UAAY0B,EAEXC,EAAGC,oBACLD,EAAGC,kBAAkBC,MAAQF,EAAG3B,WAG3B,IACL2B,EACAG,KAAMH,EAAG3B,UACT+B,cAAOC,UAAaL,EAAGM,cAAcD,IACrCE,iBAAUF,UAAaL,EAAGQ,iBAAiBH,IAC3CX,uBAAYM,EAAG3B,WACfoC,wBAAaT,EAAG1B,0BAEe,IAAzB0B,EAAGU,yBACEV,EAAGC,wBAEN,IAAIlD,MACR,gFA7BmB,mBAAeD,OAuCpC6D,EAAQ,IAAIC,UAgBX,MACLlB,kBArBcC,EAAWC,EAAOC,UACzBC,EAAKJ,EAAKC,EAAWC,EAAOC,UAsBnCC,kBAlBcE,EAAIa,yBAAMzD,SAAS0D,MACjCH,EAAMI,IAAIf,EAAIa,GACPA,EAAIrC,YAAYwB,qCAICW,kBAAO,CAA1BK,6BAEDH,EAAItD,YAAYyC,GAChB,MAAOiB,GACPC,QAAQC,MAAMF"}